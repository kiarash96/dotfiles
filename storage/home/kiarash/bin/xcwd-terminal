#!/bin/sh
#
# launch a new terminal and cd to working directory of the last children of
# current focused window.
# requires xdpyinfo and xprop

CWD=''

# get x window id
ID=$(xdpyinfo | grep focus | cut -d " " -f 4)

# get pid
PID=$(xprop -id $ID | grep PID | cut -d " " -f 3)

# get last child pid
if [ -n $PID ]; then
    CHILDPID=$(pstree -lpA | grep $PID | grep -o '[0-9]*' | tail -n 1)
    if [ -e "/proc/$CHILDPID/cwd" ]; then
        CWD=$(readlink "/proc/$CHILDPID/cwd")
    fi
fi

cd $CWD && exec $1
